/**
 * Visual Debugging Test (Slow Mode)
 * Generated by Zhuang
 */
import { test, expect } from '@playwright/test';

test.describe('Visual Debug Test', () => {
  
  const testUser = {
    username: 'e2e_test_user2',
    email: 'e2e.test@example2.com',
    password: 'TestPassword123!',
    age: 30,
    weight: 70
  };

  test('should perform login visually (slow mode)', async ({ page }) => {
    // Slow down all actions for visual debugging
    await page.goto('/login', { waitUntil: 'networkidle' });
    
    console.log('ğŸš€ Starting visual login test...');
    await page.waitForTimeout(2000); // Wait 2 seconds
    
    // Check login page loads
    await expect(page.locator('text=è¯·ç™»å½•æ‚¨çš„è´¦æˆ·')).toBeVisible();
    console.log('âœ… Login page loaded');
    await page.waitForTimeout(1000);
    
    // Fill email slowly
    console.log('ğŸ“§ Filling email...');
    await page.fill('input[placeholder="é‚®ç®±åœ°å€"]', testUser.email);
    await page.waitForTimeout(1000);
    
    // Fill password slowly  
    console.log('ğŸ”’ Filling password...');
    await page.fill('input[placeholder="å¯†ç "]', testUser.password);
    await page.waitForTimeout(1000);
    
    // Click login button
    console.log('ğŸ”˜ Clicking login button...');
    await page.click('button[type="submit"]');
    await page.waitForTimeout(3000);
    
    // Check result
    const currentUrl = page.url();
    console.log('ğŸŒ Current URL:', currentUrl);
    
    if (currentUrl.includes('/dashboard') || currentUrl === 'http://localhost:3000/') {
      console.log('ğŸ‰ Login successful! Now checking dashboard...');
      await expect(page.locator('text=å¥åº·ä»ªè¡¨æ¿')).toBeVisible({ timeout: 10000 });
      console.log('âœ… Dashboard loaded successfully');
      await page.waitForTimeout(2000);
      
      // Navigate to health records
      console.log('ğŸ¥ Navigating to health records...');
      await page.click('text=å¥åº·è®°å½•');
      await page.waitForTimeout(2000);
      
      await expect(page).toHaveURL('/health-records');
      console.log('âœ… Health records page loaded');
      await page.waitForTimeout(2000);
      
    } else {
      console.log('âŒ Login failed - still on login page');
    }
    
    console.log('ğŸ Test completed!');
    await page.waitForTimeout(3000); // Keep browser open for 3 more seconds
  });

  test('should perform health record creation visually', async ({ page }) => {
    // Login first
    await page.goto('/login');
    await page.fill('input[placeholder="é‚®ç®±åœ°å€"]', testUser.email);
    await page.fill('input[placeholder="å¯†ç "]', testUser.password);
    await page.click('button[type="submit"]');
    await page.waitForTimeout(3000);
    
    // Navigate to health records
    await page.click('text=å¥åº·è®°å½•');
    await page.waitForTimeout(2000);
    
    console.log('ğŸ¥ On health records page');
    
    // Click add record button
    console.log('â• Clicking add record button...');
    await page.click('text=æ·»åŠ è®°å½•');
    await page.waitForTimeout(2000);
    
    // Fill form slowly
    console.log('ğŸ“‹ Filling health record form...');
    await page.fill('input[placeholder="æ”¶ç¼©å‹"]', '120');
    await page.waitForTimeout(500);
    
    await page.fill('input[placeholder="èˆ’å¼ å‹"]', '80');
    await page.waitForTimeout(500);
    
    await page.fill('input[placeholder="å¿ƒç‡"]', '72');
    await page.waitForTimeout(500);
    
    await page.fill('textarea[placeholder*="æ³¨ä¿¡æ¯"]', 'Visual test record');
    await page.waitForTimeout(1000);
    
    // Submit form
    console.log('âœ… Submitting form...');
    await page.click('button:has-text("æ·»åŠ ")');
    await page.waitForTimeout(3000);
    
    // Check for success message
    const hasSuccess = await page.locator('.ant-message-success').isVisible();
    if (hasSuccess) {
      console.log('ğŸ‰ Health record created successfully!');
    } else {
      console.log('âš ï¸ No success message visible');
    }
    
    await page.waitForTimeout(3000);
    console.log('ğŸ Health record test completed!');
  });
});

#!/usr/bin/env python3
"""
Migration script to add language field to users table
Generated by Copilot
"""

from src.app import create_app
from src.extensions import db
from src.models import User

def migrate_user_language():
    """Add language field to users table with default value 'en'"""
    app = create_app()
    
    with app.app_context():
        try:
            # Try to add the column if it doesn't exist
            with db.engine.connect() as conn:
                # Check if column exists (works for SQLite and MySQL)
                try:
                    result = conn.execute(db.text("SELECT language FROM users LIMIT 1"))
                    print("Language column already exists.")
                    return
                except Exception:
                    pass
                
                # Add the column
                print("Adding language column to users table...")
                conn.execute(db.text("ALTER TABLE users ADD COLUMN language VARCHAR(5) DEFAULT 'en' NOT NULL"))
                conn.commit()
                print("Language column added successfully.")
                
        except Exception as e:
            print(f"Migration failed: {e}")
            raise

if __name__ == "__main__":
    migrate_user_language()
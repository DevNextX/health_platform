#!/bin/sh
# Generated by Zhuang
set -e

# Create writable directory for nginx configuration
mkdir -p /tmp/nginx-conf
chmod 755 /tmp/nginx-conf

# Process template and write to writable location
if [ -f /etc/nginx/templates/default.conf.template ]; then
  envsubst '${API_URL} ${LISTEN_PORT}' < /etc/nginx/templates/default.conf.template > /tmp/nginx-conf/default.conf
  echo "Generated nginx config in /tmp/nginx-conf/default.conf"
  
  # Verify the file was created successfully
  if [ -f /tmp/nginx-conf/default.conf ]; then
    echo "✅ Nginx configuration generated successfully"
    cat /tmp/nginx-conf/default.conf | head -10
  else
    echo "❌ Failed to generate nginx configuration"
    exit 1
  fi
fi

exec "$@"

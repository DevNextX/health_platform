# GitHub Secrets Configuration for CI/CD
# Generated by Zhuang

# GitHub Secrets Configuration for Secure CI/CD
# Generated by Zhuang

## üîí Security Principles

**Important**: Never commit sensitive information to the repository!
- ‚ùå Kubernetes contexts, cluster names
- ‚ùå Kubeconfig files or paths  
- ‚ùå Domain names, IP addresses
- ‚ùå API keys, tokens, certificates

## Required Secrets

Configure these secrets in your GitHub repository:
`Settings` > `Secrets and variables` > `Actions`

### 1. KUBE_CONFIG (Required)
**Description**: Base64-encoded kubeconfig file for your Kubernetes cluster  
**Security**: Contains cluster credentials - keep secure!  
**How to get**:
```bash
# Get your current kubeconfig (usually ~/.kube/config)
cat ~/.kube/config | base64 -w 0

# Or create cluster-specific kubeconfig
kubectl config view --minify --flatten --context=my-cluster | base64 -w 0
```

### 2. KUBE_CONTEXT (Optional but Recommended)
**Description**: Specific Kubernetes context name to use for deployment  
**Security**: Prevents accidental deployment to wrong cluster  
**Examples**: 
- Development: `aks-dev-cluster`
- Staging: `aks-staging-cluster`  
- Production: `aks-prod-cluster`

### 3. Environment-Specific Secrets (Recommended)

Use GitHub Environments for better security isolation:

#### Production Environment
- Create environment: `Settings` > `Environments` > `New environment` > `production`
- Required reviewers: Enable for production safety
- Environment secrets:
  - `KUBE_CONFIG` ‚Üí Production cluster kubeconfig
  - `KUBE_CONTEXT` ‚Üí `aks-prod-cluster`

#### Staging Environment  
- Create environment: `staging`
- Environment secrets:
  - `KUBE_CONFIG` ‚Üí Staging cluster kubeconfig
  - `KUBE_CONTEXT` ‚Üí `aks-staging-cluster`

## Security Best Practices

### üõ°Ô∏è Kubeconfig Security
1. **Principle of Least Privilege**: Create service accounts with minimal permissions
2. **Separate Clusters**: Use different clusters for dev/staging/prod
3. **Regular Rotation**: Rotate kubeconfig credentials regularly
4. **Audit Access**: Monitor who has access to deployment secrets

### üîê Recommended RBAC Policy
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: health-platform
  name: github-actions-deployer
rules:
- apiGroups: [""]
  resources: ["pods", "services", "configmaps", "namespaces"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
```

### üåç Dynamic Configuration
- **CORS Origins**: Automatically configured based on LoadBalancer IP
- **API URLs**: Generated using Kubernetes service discovery
- **Domain Names**: Set after deployment, not hardcoded

## Security Considerations

### Kubernetes Access
- Use service account with minimal permissions
- Restrict kubeconfig to specific namespaces if possible
- Regularly rotate credentials
- Consider using RBAC policies

### Recommended RBAC Policy
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: health-platform
  name: deployment-manager
rules:
- apiGroups: [""]
  resources: ["pods", "services", "configmaps", "namespaces"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"]
  verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
```

## Environment Setup

### Development Environment
- Create `health-platform-dev` namespace
- Use LoadBalancer service for easy access
- Lower resource limits for cost optimization

### Production Environment  
- Create `health-platform` namespace
- Configure proper resource limits
- Set up monitoring and alerting
- Use ingress controllers for production traffic

## Validation

Test your setup:
```bash
# Verify cluster access
kubectl cluster-info

# Check namespace access
kubectl auth can-i create deployments --namespace=health-platform

# Test service account permissions
kubectl auth can-i create services --namespace=health-platform
```

/**
 * Settings Page: language switcher
 * Generated by Zhuang
 * Generated by Copilot
 */
import React, { useCallback, useMemo, useState } from 'react';
import { Card, Form, Select, Button, Typography, message, Space } from 'antd';
import { useTranslation } from 'react-i18next';

const { Title } = Typography;

const Settings = () => {
  const { i18n, t } = useTranslation();
  const [form] = Form.useForm();
  const [saving, setSaving] = useState(false);

  const options = useMemo(() => ([
    { label: t('settings.language.zh'), value: 'zh' },
    { label: t('settings.language.en'), value: 'en' },
  ]), [t]);

  const initialLang = i18n.language?.startsWith('en') ? 'en' : 'zh';

  const onFinish = useCallback(async (values) => {
    try {
      setSaving(true);
      const lang = values.language || 'zh';
      await i18n.changeLanguage(lang);
      localStorage.setItem('app_language', lang);
      message.success(t('settings.saved'));
    } finally {
      setSaving(false);
    }
  }, [i18n, t]);

  return (
    <div>
      <div style={{ marginBottom: 16, display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
        <Title level={2}>{t('settings.title')}</Title>
      </div>
      <Card>
        <Form form={form} layout="vertical" onFinish={onFinish} initialValues={{ language: initialLang }}>
          <Form.Item name="language" label={t('settings.language')}>
            <Select options={options} style={{ maxWidth: 280 }} />
          </Form.Item>
          <Form.Item>
            <Space>
              <Button type="primary" htmlType="submit" loading={saving}>{t('settings.save')}</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>
    </div>
  );
};

export default Settings;

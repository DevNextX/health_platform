## Health Platform – Copilot Instructions

### 项目概述
健康记录平台：为家庭成员追踪血压、心率等健康指标的综合系统。

### 语言约定
- **代码与注释**：英文
- **协作沟通**：中文
- **提交标注**：保留 `Generated by Copilot`

### 技术栈
| 层级 | 技术 |
|-----|------|
| 后端 | Python 3.x, Flask 3.0, SQLAlchemy, JWT |
| 前端 | React 18, Ant Design 5, ECharts, i18next |
| 测试 | Pytest (单元), Playwright (E2E) |
| 部署 | Docker, Kubernetes, Azure Container Apps |

### 架构分层
```
Client → Service (HTTP) → Manager (DB) → Models
```
- **Service 层** (`src/service/`): 处理请求、验证参数
- **Manager 层** (`src/manager/`): 数据库操作、业务逻辑
- ⚠️ 禁止在 Service 层直接查询数据库

### 关键规则

| 规则 | 说明 |
|-----|------|
| Self 成员保护 | "Self/自己" 不可编辑/删除，后端识别两种名称 |
| 分页参数 | 使用 `page` + `size`（不是 `per_page`） |
| 血压校验 | 30-250 mmHg，收缩压 > 舒张压 |
| 心率校验 | 可选，30-150 bpm |
| Tag 过滤 | 精确匹配 + OR 语义，`ensure_ascii=False` |
| 时间处理 | 使用 `datetime.now(UTC)`，不用 `utcnow()` |
| CSV 导出 | UTF-8 BOM + RFC5987 `filename*` |

### 开发流程
1. 修改 Manager 层添加业务逻辑
2. 在 Service 层暴露 API
3. 更新/添加 Pytest 测试
4. 如涉及 UI，更新 Playwright E2E

### 关键文件
| 类型 | 文件 |
|-----|------|
| 后端核心 | `src/service/health_service.py`, `src/manager/health_manager.py`, `src/models.py` |
| 前端核心 | `frontend/src/pages/HealthRecords.js`, `frontend/src/services/api.js` |
| 测试 | `tests/test_health.py`, `tests/e2e/tests/` |

### 相关文档
- **[开发环境搭建](../docs/DEVELOPMENT.md)** - 环境配置、启动命令、测试运行
- **[贡献指南](../CONTRIBUTING.md)** - 代码规范、Git 提交、版本发布
- **[API 设计](../docs/API_Design.md)** - 接口文档
- **[管理员功能](../docs/ADMIN-PASSWORD-RESET.md)** - 角色管理、密码重置

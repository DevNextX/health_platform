# 文档体系与协作流程（精简版）

目标：最小必要、可追溯、支持敏捷迭代。避免在需求阶段写实现细节，把细节放到正确阶段。

## 目录结构
- /docs/requirements/ 需求精炼产物（文件：req-<slug>.md）
- /docs/plans/ 实施计划（文件：plan-<slug>.md）
- /docs/api/ API 契约设计（文件：api-<slug>.md）
- /docs/templates/ 模板与约定

## 三阶段概览
| 阶段 | 产出 | 进入条件 | 产出完成标准 | 禁止内容 |
|------|------|----------|--------------|----------|
| 需求精炼 | req-*.md | 想法 / Issue 触发 | 明确范围/价值/验收 | 具体类名、SQL、接口实现细节 |
| 实施计划 | plan-*.md | 需求状态=已澄清/已同意 | 明确 MVP 与任务拆分、风险、测试策略 | 逐行代码、复杂 UML |
| API 设计 | api-*.md | 计划通过且涉及新/改接口 | 路径、方法、字段、约束、错误语义清晰 | 底层存储实现、内部模型名 |

## 流程守则
1. Discuss → Confirm → Generate：需求阶段必须先讨论再生成文档。
2. 一个文档只聚焦一个主题；多个不相关主题拆分多个需求文件。
3. 需求文档不写 API 细节；API 契约放 /docs/api/。
4. 实施计划必须标识 MVP 任务清单；后续功能列入 Phase 2 区域。
5. 任务粒度：0.5 ~ 2 人日；验收条目需能映射到至少一个测试。
6. 若需求变更：新增 -v2 文件；旧文件头部可注明 superseded by。

## 文件命名
- 需求：req-<slug>.md （示例：req-wechat-miniprogram.md）
- 计划：plan-<slug>.md （示例：plan-wechat-miniprogram.md）
- API：api-<slug>.md （示例：api-wechat-auth.md）

## 常见角色提问提示
- 是否需要拆分？（不同价值线 / 可独立上线 / 不同风险域）
- 是否最小可行？（若删除某项仍有价值则推迟）
- 是否有可量化验收？（无 → 需补）

## Feature Flag 建议
- 新渠道 / 新语言 / 新算法默认用开关包裹
- 计划文档列出 flag 名称与默认值

## 追踪与回链
- plan 中“关联需求”列出多个 req 文件
- 测试代码中可用注释：# TRACE: req-wechat-miniprogram 验收：登录成功

## 快速开始
1. 用 `refine-issue.template.md` 讨论并生成 req 文档
2. 用 `implementation-plan.template.md` 拆分 MVP 与 Phase 2
3. 若涉及接口新增，使用 `api-architect.template.md` 生成契约
4. 实现 / 提交 / 测试回链

## 何时新增 v2
- 新范围显著改变原有验收或否定部分原假设
- 重构目标改变用户可见行为

---
（Generated by Copilot）

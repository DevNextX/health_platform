# GitHub Variables 优化配置指南
# Generated by Zhuang

## 🎯 **优化策略说明**

### **配置层级架构**
```
Repository Variables (全局共享)
├── 所有环境相同的变量
└── 基础配置信息

Environment Variables (环境特定)
├── 仅该环境不同的变量
└── 环境特定配置

Hardcoded Values (代码中固定)
├── 资源限制配置
└── 不需要变更的固定值
```

---

## 📋 **推荐的变量配置**

### **1. Repository Variables (仓库级别 - 所有环境共享)**
在 `Settings` → `Secrets and variables` → `Actions` → `Variables` 中配置：

```bash
# 容器镜像仓库配置 (所有环境相同)
REGISTRY_URL=ghcr.io/devnextx

# 基础配置 (所有环境相同)
ORGANIZATION_NAME=DevNextX
PROJECT_NAME=health-platform
```

### **2. Environment Variables (环境级别 - 环境特定)**

#### **Development Environment**
```bash
# 环境标识
ENVIRONMENT_NAME=development

# Kubernetes配置
NAMESPACE=health-platform-dev

# 服务配置
SERVICE_TYPE=LoadBalancer

# 副本数配置 (开发环境资源较少)
BACKEND_REPLICAS=1
FRONTEND_REPLICAS=1

# 镜像标签 (开发环境)
IMAGE_TAG=development
```

#### **Staging Environment**
```bash
# 环境标识
ENVIRONMENT_NAME=staging

# Kubernetes配置
NAMESPACE=health-platform-staging

# 服务配置
SERVICE_TYPE=LoadBalancer

# 副本数配置 (预发布环境中等资源)
BACKEND_REPLICAS=2
FRONTEND_REPLICAS=2

# 镜像标签 (预发布环境)
IMAGE_TAG=staging
```

#### **Production Environment**
```bash
# 环境标识
ENVIRONMENT_NAME=production

# Kubernetes配置
NAMESPACE=health-platform-prod

# 服务配置
SERVICE_TYPE=LoadBalancer

# 副本数配置 (生产环境高可用)
BACKEND_REPLICAS=3
FRONTEND_REPLICAS=3

# 镜像标签 (生产环境)
IMAGE_TAG=production
```

### **3. Hardcoded Values (代码中固定)**
这些值在所有环境中都相同，直接写在YAML文件中：

```yaml
# 资源限制配置 (固定值)
BACKEND_MEMORY_REQUEST: 256Mi
BACKEND_CPU_REQUEST: 250m
BACKEND_MEMORY_LIMIT: 512Mi
BACKEND_CPU_LIMIT: 500m
FRONTEND_MEMORY_REQUEST: 128Mi
FRONTEND_CPU_REQUEST: 100m
FRONTEND_MEMORY_LIMIT: 256Mi
FRONTEND_CPU_LIMIT: 200m

# Flask环境配置 (根据环境固定)
Development: FLASK_ENV=development
Staging: FLASK_ENV=staging  
Production: FLASK_ENV=production
```

---

## 🔧 **变量引用方式**

### **在GitHub Actions中的使用**
```yaml
env:
  # Repository级别变量 (全局共享)
  REGISTRY_URL: ${{ vars.REGISTRY_URL }}
  
  # Environment级别变量 (环境特定)
  NAMESPACE: ${{ vars.NAMESPACE }}
  BACKEND_REPLICAS: ${{ vars.BACKEND_REPLICAS }}
  
  # 固定值 (直接写死)
  BACKEND_MEMORY_REQUEST: 256Mi
  FLASK_ENV: development  # 或根据环境写死
```

---

## 📊 **优化效果对比**

### **优化前**
- 每个环境需要配置 12+ 个变量
- 大量重复配置
- 资源限制需要为每个环境单独配置

### **优化后**
- Repository级别: 2-3 个共享变量
- Environment级别: 5-6 个特定变量
- 资源限制: 0 个变量 (硬编码)

### **维护成本**
- **减少 60%** 的变量配置工作
- **消除重复** 的共享配置
- **简化维护** 流程

---

## 🚀 **实施步骤**

### **Step 1: 配置Repository Variables**
1. 进入 `Settings` → `Secrets and variables` → `Actions`
2. 在 `Variables` 标签页添加:
   - `REGISTRY_URL=ghcr.io/devnextx`

### **Step 2: 简化Environment Variables**
保持当前Environment Variables，移除不需要的资源限制变量:
- ✅ 保留: `BACKEND_REPLICAS`, `FRONTEND_REPLICAS`, `NAMESPACE`, `SERVICE_TYPE`
- ❌ 移除: 所有 `*_MEMORY_*`, `*_CPU_*` 变量

### **Step 3: 验证配置**
运行更新后的部署工作流，确认变量正确加载。

---

## ✅ **最终推荐配置**

你只需要配置以下变量：

### **Repository Variables (1个)**
- `REGISTRY_URL`

### **Development Environment Variables (4个)**  
- `NAMESPACE`
- `BACKEND_REPLICAS`
- `FRONTEND_REPLICAS` 
- `SERVICE_TYPE`

### **Secrets (2个)**
- `DEV_KUBE_CONFIG`
- `DEV_KUBE_CONTEXT`

**总计**: 7个配置项 vs 之前的15+个配置项 = **减少53%的配置工作量**！

# 管理员重置密码流程说明

本说明面向平台管理员/超级管理员，描述如何安全地为用户重置密码，以及用户侧的配合操作与注意事项。

## 适用角色与权限
- SUPER_ADMIN：可将用户在 USER/ADMIN 间进行“提升/降级”；可重置任何用户（包括 SUPER_ADMIN）的密码。
- ADMIN：不可变更角色；可重置任何用户（包括 SUPER_ADMIN）的密码。
- USER：无权进行该操作。
- 限制：管理员不能通过管理员接口重置“自己的”密码（需到“系统设置”中自助修改）。

## 操作路径（前端界面）
1. 登录后台 → 进入“用户管理”。
2. 找到目标用户，点击“重置密码”。
3. 弹出确认框 → 点击“确认”。
4. 系统自动生成一个“临时密码”，并以弹窗方式显示；点击复制并通过安全渠道传达给用户。
   - 提示：临时密码仅在此时展示，请妥善保存与传达。

## 系统行为（后端）
- 服务器自动生成强度充足的“临时密码”（至少 12 位；包含大小写字母、数字、符号）。
- 为用户设置该临时密码，并将用户标记为 must_change_password = true。
- 同步提升 token_version，使该用户当前刷新令牌失效（相当于登出所有会话）。
- 接口返回：`{ message, temp_password }`，供管理员传达给用户。

接口：`POST /api/v1/admin/users/{user_id}/reset-password`
- 权限要求：ADMIN 及以上
- 自身限制：若 `{user_id}` 为当前操作者，则返回 400（提示请使用自助改密）。

## 用户侧流程与提示话术
- 管理员可向用户发送如下说明（示例）：
  - 您的账户密码已重置，请使用以下临时密码登录系统：`<临时密码>`。
  - 出于安全考虑，首次登录后系统会引导您立即修改密码（“系统设置” → “修改密码”）。
  - 密码要求：至少 8 位，同时包含字母与数字；建议包含大小写与符号以提升强度。

## 首登强制改密
- 用户使用“临时密码”首次登录时将被强制重定向至“系统设置”，顶部展示“首次登录向导”，需先完成改密。
- 改密成功后，系统提示“请使用新密码重新登录”，并自动登出；用户需用新密码登录进入主页面。

## 安全建议（操作与传达）
- 传达“临时密码”请使用安全通道（如受控 IM、电话语音核实、S/MIME 邮件等），避免在公共群组或明文可检索位置发送。
- 在合理时间内督促用户完成改密操作。
- 若发现临时密码可能泄露，请立即再次执行“重置密码”。
- 管理员切勿在公共位置记录或长期保存临时密码；避免在截图/工单系统中留存明文。

## 常见问题
- Q：重置后用户还能用旧密码吗？
  - A：不能。系统已将该用户 token_version 提升，刷新令牌失效；旧密码也已被新密码替换。
- Q：用户登录后为什么访问会 403？
  - A：属于“强制改密”拦截，需先在“系统设置”页完成改密，随后即可正常访问。
- Q：管理员能否重置自己的密码？
  - A：不可以；请到“系统设置”中自助修改密码。

---
如需更严格的流程（如临时密码时效、短信/邮件模板、审计日志、审批流等），可在后续版本进行增强。
